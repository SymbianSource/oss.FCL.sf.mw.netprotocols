## Include script - trans2 failed response data in several chunks, 2nd SDU empty, aMoreData = ETrue
#
# Body data -
# response_data_1_stub.txt, in 4 parts, response_data_1a_stub.txt, response_data_1b_stub.txt, response_data_1c_stub.tx, empty body
#
# Header data- 
# Content-Type : application/vnd.wap.wmlc
# Trailer : Server
#
# The method will be in the Null state
#
SCRIPT trans2_response_failed_emptybody_driver
#
# Expect the S-MethodResult.ind primitive - first the headers event...
#
	EXPECT
		INVOCATION TransactionRunL
			VALIDATE aTransaction trans2
			VALIDATE aEvent EGotResponseHeaders
		ENDINVOCATION
	ENDEXPECT
#
# ...then the body data event - first part
#
	EXPECT
		INVOCATION TransactionRunL
			VALIDATE aTransaction trans2
			VALIDATE aEvent EGotResponseBodyData
		ENDINVOCATION
	ENDEXPECT
#
# Check the status code and the content-type header and server header
#
	SLEEP 500
	SEND
		INVOKE trans2 GetStatusCode
			VALIDATE :RETURN: 200
		ENDINVOKE
		INVOKE trans2 GetHeaderL
			PARAMETER aFieldName Content-Type
			VALIDATE aFieldType RStringF
			VALIDATE aFieldValue application/vnd.wap.wmlc
			PARAMETER aPart 0
			VALIDATE :RETURN: ETrue
		ENDINVOKE
		INVOKE trans2 GetHeaderL
			PARAMETER aFieldName Server
			VALIDATE aFieldType RStringF
			VALIDATE aFieldValue bunny
			PARAMETER aPart 0
			VALIDATE :RETURN: ETrue
		ENDINVOKE
	ENDSEND
#
# Get the response body data supplier and the data - first part
#
	SEND
		INVOKE trans2 GetBody
			STOREITEM :RETURN: respBody2
		ENDINVOKE
		INVOKE respBody2 MHTTPDataSupplier::OverallDataSize
			VALIDATE :RETURN: 200
		ENDINVOKE
		INVOKE respBody2 MHTTPDataSupplier::GetNextDataPart
			VALIDATE aDataPart <$file$C:\HttpTest\wsp_pr_hnd_driver\response_data_2a_driver.txt$file$>
			VALIDATE :RETURN: EFalse
		ENDINVOKE
	ENDSEND
	SEND
		INVOKE respBody2 MHTTPDataSupplier::ReleaseData
		ENDINVOKE
	ENDSEND
#
# Expect more body data... - second part
#
	EXPECT
		INVOCATION TransactionRunL
			VALIDATE aTransaction trans2
			VALIDATE aEvent EGotResponseBodyData
		ENDINVOCATION
	ENDEXPECT
#
# Get the data - second part
#
	SLEEP 500
	SEND
		INVOKE respBody2 MHTTPDataSupplier::GetNextDataPart
			VALIDATE aDataPart <$file$C:\HttpTest\wsp_pr_hnd_driver\response_data_2b_driver.txt$file$>
			VALIDATE :RETURN: EFalse
		ENDINVOKE
	ENDSEND
	SEND
		INVOKE respBody2 MHTTPDataSupplier::ReleaseData
		ENDINVOKE
	ENDSEND
#
# Expect more body data... - third part
#
	EXPECT
		INVOCATION TransactionRunL
			VALIDATE aTransaction trans2
			VALIDATE aEvent EGotResponseBodyData
		ENDINVOCATION
	ENDEXPECT
#
# Get the data - third part
#
	SLEEP 500
	SEND
		INVOKE respBody2 MHTTPDataSupplier::GetNextDataPart
			VALIDATE aDataPart <$file$C:\HttpTest\wsp_pr_hnd_driver\response_data_2c_driver.txt$file$>
			VALIDATE :RETURN: EFalse
		ENDINVOKE
	ENDSEND
	SEND
		ALLOWREENTRANCY
		INVOKE respBody2 MHTTPDataSupplier::ReleaseData
		ENDINVOKE
	ENDSEND
#
# There should be a failure now - EFailed event
#
	EXPECT
		INVOCATION TransactionRunL
			VALIDATE aTransaction trans2
			VALIDATE aEvent EFailed
		ENDINVOCATION
	ENDEXPECT
ENDSCRIPT
